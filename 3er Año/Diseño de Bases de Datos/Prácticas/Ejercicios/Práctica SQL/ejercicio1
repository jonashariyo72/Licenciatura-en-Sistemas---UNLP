/* 6. Listar  nombre, apellido, DNI, teléfono y dirección de clientes que compraron los productos con 
nombre ‘prod1’ y ‘prod2’ pero nunca compraron el producto con nombre ‘prod3’ */


SELECT nombre, apellido, DNI, telefono, direccion
FROM Cliente c 
WHERE c.idCliente IN 
(SELECT c.idCliente
FROM Cliente c INNER JOIN Factura f ON (c.idCliente = f.idCliente) INNER JOIN Detalle d ON (f.nroTicket = d.nroTicket)  INNER JOIN Producto p ON (p.idProducto = d.idProducto) 
WHERE (nombreP) = 'prod1')
AND c.idCliente IN (SELECT c.idCliente
FROM Cliente c INNER JOIN Factura f ON (c.idCliente = f.idCliente) INNER JOIN Detalle d ON (f.nroTicket = d.nroTicket)  INNER JOIN Producto p ON (p.idProducto = d.idProducto) 
WHERE (nombreP) = 'prod2')
AND c.idCliente NOT IN (SELECT c.idCliente
FROM Cliente c INNER JOIN Factura f ON (c.idCliente = f.idCliente) INNER JOIN Detalle d ON (f.nroTicket = d.nroTicket)  INNER JOIN Producto p ON (p.idProducto = d.idProducto) 
WHERE (nombreP) = 'prod3')

/*7. Listar nroTicket, total, fecha, hora y DNI del cliente, de aquellas facturas donde se haya 
comprado el producto ‘prod38’ o la factura tenga fecha de 2023. */


SELECT f.nroTicket, total, fecha, hora, c.DNI, nombreP
FROM Factura f INNER JOIN Cliente c ON (f.idCliente = c.idCliente)
INNER JOIN Detalle d ON (d.nroTicket = f.nroTicket)
INNER JOIN Producto p ON (p.idProducto = d.idProducto)
WHERE (nombreP='prod38') OR YEAR(fecha)=2023

/* 9. Listar nroTicket, total, fecha, hora para las facturas del cliente ´Jorge Pérez´ donde no haya 
comprado el producto ´Z´. */

SELECT f.nroTicket, total, fecha, hora, c.DNI, nombreP
FROM Cliente c INNER JOIN Factura f ON (f.idCliente = c.idCliente) 
INNER JOIN Detalle d ON (d.nroTicket = f.nroTicket)
INNER JOIN Producto p ON (p.idProducto = d.idProducto)
WHERE (nombreP<>'Z') AND (c.nombre = 'Jorge') AND (c.apellido = 'Perez')

/* 10. Listar DNI, apellido y nombre de clientes donde el monto total comprado, teniendo en cuenta 
todas sus facturas, supere  $100000. */

SELECT c.DNI, c.apellido, c.nombre
FROM Cliente c
INNER JOIN Factura f ON (f.idCliente = c.idCliente)
GROUP BY c.idCliente
HAVING SUM(f.total) > 100000