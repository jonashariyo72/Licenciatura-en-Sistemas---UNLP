/* 
Banda = (codigoB, nombreBanda, genero_musical, anio_creacion)  
Integrante = (DNI, nombre, apellido, dirección, email, fecha_nacimiento, codigoB(fk))  
Escenario = (nroEscenario, nombre_escenario, ubicación, cubierto, m2, descripción)  
Recital = (fecha, hora, nroEscenario (fk), codigoB (fk)) 
*/ 


/* 1. Listar DNI, nombre, apellido,dirección y email de integrantes nacidos entre 1980 y 1990 y que 
hayan realizado algún recital durante 2023. */

SELECT DNI, nombre, apellido, direccion, email
FROM Integrante i 
INNER JOIN Banda b ON (i.codigoB = b.codigoB) 
INNER JOIN Recital r ON (b.codigoB = r.codigoB)
WHERE (fecha_nacimiento) >= '1980-01-01' AND (fecha_nacimiento) <= '1990-12-31' AND (fecha) >= '2023-01-01' AND (fecha) <= '2023-12-31'

/* 2. Reportar nombre, género musical y año de creación de bandas que hayan realizado recitales 
durante 2023, pero no hayan tocado durante 2022 . */

SELECT nombreBanda, genero_musical, anio_creacion
FROM Banda b 
WHERE b.codigoB IN
(SELECT b.codigoB
FROM Banda b 
INNER JOIN Recital r ON (b.codigoB = r.codigoB)
WHERE (fecha) >= '2023-01-01' AND (fecha) <= '2023-12-31')
AND b.codigoB NOT IN
(SELECT b.codigoB
FROM Banda b 
INNER JOIN Recital r ON (b.codigoB = r.codigoB)
WHERE (fecha) >= '2022-01-01' AND (fecha) <= '2022-12-31')

/* 3. Listar el cronograma de recitales del día 04/12/2023. Se deberá listar nombre de la banda que 
ejecutará el recital, fecha, hora, y el nombre y ubicación del escenario correspondiente. */

SELECT nombreBanda, fecha, hora, nombre_escenario, ubicacion
FROM Banda b 
INNER JOIN Recital r ON (b.codigoB = r.codigoB)
INNER JOIN Escenario e ON (r.nroEscenario = e.nroEscenario)
WHERE (fecha) = '2023-12-04'

/* 4. Listar DNI, nombre, apellido,email de integrantes que hayan tocado en el escenario con nombre 
‘Gustavo Cerati’ y en el escenario  con nombre ‘Carlos Gardel’ */

SELECT DNI, nombre, apellido, email
FROM Integrante i
INNER JOIN Banda b ON (i.codigoB = b.codigoB) 
INNER JOIN Recital r ON (b.codigoB = r.codigoB)
INNER JOIN Escenario e ON (r.nroEscenario = e.nroEscenario)
WHERE (nombre_escenario) = 'Gustavo Cerati'
INTERSECT
SELECT DNI, nombre, apellido, email, ubicacion
FROM Integrante i 
INNER JOIN Banda b ON (i.codigoB = b.codigoB) 
INNER JOIN Recital r ON (b.codigoB = r.codigoB)
INNER JOIN Escenario e ON (r.nroEscenario = e.nroEscenario)
WHERE (nombre_escenario) = 'Carlos Gardel'

//////////////////////////////////////////////////////////

SELECT DNI, nombre, apellido, email
FROM Integrante i 
WHERE i.DNI IN 
(SELECT i.DNI
FROM Integrante i
INNER JOIN Banda b ON (i.codigoB = b.codigoB) 
INNER JOIN Recital r ON (b.codigoB = r.codigoB)
INNER JOIN Escenario e ON (r.nroEscenario = e.nroEscenario)
WHERE (nombre_escenario) = 'Gustavo Cerati')
AND i.DNI IN
(SELECT i.DNI
FROM Integrante i
INNER JOIN Banda b ON (i.codigoB = b.codigoB) 
INNER JOIN Recital r ON (b.codigoB = r.codigoB)
INNER JOIN Escenario e ON (r.nroEscenario = e.nroEscenario)
WHERE (nombre_escenario) = 'Carlos Gardel')

/* 5. Reportar nombre, género musical y año de creación de bandas que tengan más de 5 integrantes. */

SELECT nombreBanda, genero_musical, anio_creacion
FROM Banda b
INNER JOIN Integrante i ON (b.codigoB = i.codigoB)
GROUP BY b.codigoB, b.nombreBanda, b.genero_musical, b.año_creacion
HAVING COUNT(*) > 5

/* 6. Listar nombre de escenario, ubicación y descripción de escenarios que solo tuvieron recitales 
con el género musical rock and roll. Ordenar por nombre de escenario */

SELECT nombre_escenario, ubicacion, descripcion
FROM Escenario e 
INNER JOIN Recital r ON (e.nroEscenario = r.nroEscenario)
INNER JOIN  Banda b ON (r.codigoB = b.codigoB)
WHERE (genero_musical) = 'Rock and roll'
ORDER BY nombre_escenario
EXCEPT
(SELECT nombre_escenario, ubicacion, descripcion
FROM Escenario e 
INNER JOIN Recital r ON (e.nroEscenario = r.nroEscenario)
INNER JOIN  Banda b ON (r.codigoB = b.codigoB)
WHERE (genero_musical) <> 'Rock and roll')
ORDER BY nombre_escenario

/* 7. Listar nombre, género musical y año de creación de bandas que hayan realizado recitales en 
escenarios cubiertos durante 2023.// cubierto es true, false según corresponda  */


SELECT nombreBanda, genero_musical, anio_creacion, cubierto
FROM Banda b 
INNER JOIN Recital r ON (b.codigoB = r.codigoB)
INNER JOIN Escenario e ON (r.nroEscenario = e.nroEscenario)
WHERE (cubierto = true) AND (YEAR(r.fecha)=2023)

/* 8. Reportar para cada escenario, nombre del escenario y cantidad de recitales durante 2024.  */

SELECT nombre_escenario, SUM(YEAR(r.fecha)=2024) as recitalesEn2024
FROM Recital r
INNER JOIN Escenario e ON (r.nroEscenario = e.nroEscenario)
GROUP BY nombre_escenario
