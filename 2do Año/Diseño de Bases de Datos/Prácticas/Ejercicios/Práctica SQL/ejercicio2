/* Ejercicio 2 


Localidad = (codigoPostal, nombreL, descripcion, nroHabitantes) 
Arbol = (nroArbol, especie, anios, calle, nro, codigoPostal(fk)) 
Podador = (DNI, nombre, apellido, telefono, fnac, codigoPostalVive(fk)) 
Poda = (codPoda, fecha, DNI(fk), nroArbol(fk))

*/

/*1. Listar especie, años, calle, nro y localidad de árboles podados por el podador ‘Juan Perez’ y por 
el podador ‘Jose Garcia’.  */

SELECT especie, anios, calle, nro, nombreL
FROM Arbol a INNER JOIN Localidad l ON (a.codigoPostal = l.codigoPostal)
WHERE a.nroArbol IN
(SELECT a.nroArbol
FROM Arbol a INNER JOIN Localidad l ON (a.codigoPostal = l.codigoPostal) 
INNER JOIN Poda poda ON (a.nroArbol = poda.nroArbol)
INNER JOIN Podador p ON (poda.DNI = p.DNI)
WHERE (p.nombre) = 'Juan' AND (p.apellido) = 'Perez'
)
AND a.nroArbol IN
(SELECT a.nroArbol
FROM Arbol a INNER JOIN Localidad l ON (a.codigoPostal = l.codigoPostal) 
INNER JOIN Poda poda ON (a.nroArbol = poda.nroArbol)
INNER JOIN Podador p ON (poda.DNI = p.DNI)
WHERE (p.nombre) = 'Jose' AND (p.apellido) = 'Garcia'
)

/*2. Reportar DNI, nombre, apellido, fecha de nacimiento y localidad donde viven de aquellos 
podadores que tengan podas realizadas durante 2023. */


SELECT p.DNI, nombre, apellido, fnac, nombreL
FROM Poda poda 
INNER JOIN Podador p ON (poda.DNI = p.DNI) 
INNER JOIN Localidad l ON (p.codigoPostalVive = l.codigoPostal) 
WHERE (poda.fecha) >= '2023-01-01' AND (poda.fecha) <= '2023-12-31'

/* 3. Listar especie, años, calle, nro y localidad de árboles que no fueron podados nunca. */


SELECT especie, anios, calle, nro, nombreL
FROM Arbol a INNER JOIN Localidad l ON (a.codigoPostal = l.codigoPostal)
WHERE a.nroArbol NOT IN
(SELECT a.nroArbol
FROM Arbol a 
INNER JOIN Poda poda ON (a.nroArbol = poda.nroArbol))

/* 4. Reportar especie, años,calle, nro y localidad de árboles que fueron podados durante 2022 y  no 
fueron podados durante 2023. */


SELECT especie, anios, calle, nro, nombreL
FROM Arbol a INNER JOIN Localidad l ON (a.codigoPostal = l.codigoPostal)
WHERE a.nroArbol IN
(SELECT a.nroArbol
FROM Arbol a 
INNER JOIN Poda poda ON (a.nroArbol = poda.nroArbol)
WHERE (poda.fecha) >= '2022-01-01' AND (poda.fecha) <= '2022-12-31')
AND a.nroArbol NOT IN 
(SELECT a.nroArbol
FROM Arbol a 
INNER JOIN Poda poda ON (a.nroArbol = poda.nroArbol)
WHERE (poda.fecha) >= '2023-01-01' AND (poda.fecha) <= '2023-12-31')


/* 5. Reportar DNI, nombre, apellido, fecha de nacimiento y localidad donde viven de aquellos 
podadores con apellido terminado con el string ‘ata’  y que tengan al menos una poda durante 
2024. Ordenar por apellido y nombre. */



SELECT p.DNI, nombre, apellido, fnac, nombreL
FROM Poda poda 
INNER JOIN Podador p ON (poda.DNI = p.DNI) 
INNER JOIN Localidad l ON (p.codigoPostalVive = l.codigoPostal) 
WHERE (p.apellido LIKE '%ata')  AND (poda.fecha) <= '2024-12-31' AND (poda.fecha) >= '2024-01-01'
ORDER BY p.apellido, p.nombre